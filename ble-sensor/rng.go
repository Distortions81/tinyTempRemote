package main

// tinyRNG is a minimal deterministic pseudo-random generator that iterates
// over a table of pre-generated bytes. It's not cryptographically secure but
// good enough for picking pseudo-random positions to avoid OLED burn-in.
type tinyRNG struct {
	index int
	seed  uint32
}

var rngTable = [...]byte{
	213, 5, 152, 188, 99, 138, 223, 82,
	191, 63, 221, 133, 89, 95, 181, 46,
	211, 85, 75, 105, 39, 97, 174, 164,
	12, 234, 173, 13, 212, 1, 3, 83,
	91, 146, 50, 212, 54, 93, 192, 119,
	168, 20, 118, 61, 255, 110, 95, 131,
	222, 66, 21, 84, 154, 4, 76, 117,
	179, 175, 80, 197, 165, 6, 25, 31,
	227, 40, 198, 91, 5, 188, 110, 62,
	246, 31, 7, 251, 166, 215, 103, 186,
	61, 76, 40, 253, 84, 171, 118, 104,
	83, 83, 147, 76, 46, 1, 75, 1,
	253, 94, 49, 135, 207, 33, 235, 213,
	93, 124, 94, 13, 190, 169, 90, 202,
	91, 91, 127, 211, 213, 166, 61, 34,
	235, 99, 103, 69, 119, 169, 149, 64,
	30, 133, 218, 22, 186, 55, 34, 79,
	190, 18, 140, 227, 188, 205, 157, 229,
	135, 159, 252, 245, 25, 135, 228, 15,
	112, 176, 69, 1, 42, 15, 56, 96,
	203, 251, 93, 139, 178, 106, 153, 161,
	198, 38, 154, 188, 20, 214, 97, 82,
	41, 73, 156, 118, 170, 217, 102, 7,
	76, 58, 16, 174, 200, 163, 20, 123,
	51, 248, 76, 105, 132, 183, 81, 145,
	19, 46, 48, 106, 209, 7, 77, 166,
	83, 234, 212, 225, 12, 190, 14, 198,
	181, 8, 163, 240, 224, 23, 163, 160,
	199, 152, 64, 194, 29, 56, 248, 60,
	49, 89, 17, 26, 158, 110, 49, 235,
	255, 240, 30, 216, 112, 113, 168, 83,
	196, 123, 241, 92, 106, 109, 81, 233,
	7, 99, 37, 35, 62, 48, 135, 120,
	109, 142, 115, 254, 189, 228, 206, 127,
	230, 55, 15, 188, 122, 204, 252, 42,
	215, 238, 56, 167, 127, 227, 155, 217,
	63, 87, 111, 197, 134, 90, 2, 141,
	12, 245, 170, 103, 154, 14, 203, 187,
	110, 128, 117, 47, 104, 128, 2, 8,
	77, 68, 168, 109, 65, 156, 146, 14,
	107, 219, 201, 205, 225, 143, 144, 37,
	244, 247, 81, 216, 24, 50, 61, 136,
	161, 211, 200, 244, 47, 199, 62, 220,
	117, 3, 234, 79, 7, 182, 81, 138,
	73, 198, 82, 159, 165, 161, 220, 20,
	181, 125, 234, 13, 177, 200, 254, 70,
	191, 152, 67, 255, 231, 5, 238, 188,
	118, 209, 241, 115, 174, 251, 151, 117,
	212, 163, 49, 76, 95, 23, 62, 198,
	64, 189, 32, 102, 110, 0, 48, 172,
	133, 127, 141, 158, 177, 161, 200, 10,
	61, 224, 225, 161, 120, 130, 50, 87,
	148, 31, 65, 72, 100, 137, 108, 130,
	183, 24, 40, 72, 119, 22, 71, 10,
	18, 73, 193, 217, 215, 12, 88, 79,
	73, 251, 53, 182, 38, 79, 11, 36,
	181, 67, 184, 175, 108, 150, 100, 169,
	207, 36, 169, 83, 128, 241, 86, 67,
	196, 12, 227, 75, 131, 69, 79, 129,
	130, 148, 1, 188, 205, 103, 192, 51,
	55, 86, 237, 94, 38, 55, 55, 211,
	77, 23, 229, 61, 206, 132, 146, 67,
	115, 90, 50, 218, 75, 142, 124, 61,
	160, 202, 134, 109, 191, 199, 158, 2,
	149, 221, 230, 214, 248, 53, 242, 242,
	112, 23, 179, 89, 97, 112, 39, 106,
	90, 67, 89, 2, 52, 66, 7, 30,
	133, 62, 152, 6, 246, 115, 173, 47,
	12, 6, 210, 51, 158, 227, 35, 37,
	196, 79, 231, 167, 240, 73, 192, 127,
	210, 73, 221, 182, 115, 199, 7, 236,
	176, 60, 244, 188, 61, 139, 38, 103,
	13, 53, 206, 165, 253, 93, 122, 137,
	218, 12, 75, 62, 87, 195, 119, 55,
	96, 208, 6, 96, 228, 215, 169, 199,
	215, 139, 208, 27, 94, 49, 187, 226,
	5, 157, 25, 236, 53, 228, 222, 67,
	21, 43, 84, 79, 224, 224, 14, 162,
	210, 167, 175, 211, 250, 135, 165, 217,
	40, 91, 127, 250, 246, 45, 173, 137,
	163, 247, 177, 158, 180, 93, 173, 38,
	52, 234, 222, 235, 230, 104, 218, 114,
	124, 180, 235, 163, 223, 208, 49, 12,
	180, 224, 11, 124, 19, 73, 191, 0,
	99, 13, 148, 202, 92, 102, 169, 162,
	174, 216, 125, 98, 239, 1, 119, 117,
	118, 227, 90, 20, 238, 71, 69, 238,
	180, 116, 164, 15, 50, 81, 68, 62,
	61, 168, 222, 170, 178, 107, 197, 44,
	218, 101, 227, 106, 59, 81, 90, 190,
	57, 63, 140, 73, 174, 113, 244, 15,
	135, 142, 249, 170, 0, 167, 13, 187,
	124, 11, 32, 88, 112, 185, 149, 229,
	236, 16, 18, 36, 47, 164, 111, 217,
	166, 8, 55, 102, 154, 70, 68, 215,
	99, 239, 168, 84, 214, 189, 67, 183,
	115, 228, 219, 253, 154, 127, 220, 43,
	126, 211, 94, 4, 173, 140, 248, 6,
	160, 219, 131, 247, 55, 130, 172, 110,
	3, 4, 191, 68, 81, 94, 157, 206,
	46, 231, 43, 183, 194, 56, 215, 38,
	55, 85, 18, 83, 160, 29, 101, 127,
	108, 56, 204, 76, 189, 194, 145, 37,
	12, 167, 162, 233, 51, 157, 0, 101,
	141, 191, 15, 136, 185, 3, 227, 216,
	247, 6, 58, 36, 48, 202, 144, 52,
	191, 222, 47, 176, 213, 35, 168, 1,
	172, 9, 100, 209, 46, 161, 136, 170,
	153, 3, 248, 93, 25, 197, 147, 93,
	44, 44, 122, 138, 201, 5, 197, 198,
	145, 37, 26, 48, 58, 43, 119, 77,
	0, 126, 101, 94, 180, 163, 37, 121,
	10, 195, 182, 40, 237, 100, 134, 240,
	106, 216, 63, 103, 217, 227, 159, 237,
	125, 207, 187, 130, 201, 213, 46, 5,
	169, 58, 129, 141, 139, 69, 219, 232,
	133, 44, 198, 132, 131, 208, 10, 164,
	197, 147, 81, 171, 86, 122, 81, 186,
	60, 184, 97, 127, 210, 73, 181, 29,
	226, 183, 38, 13, 254, 248, 43, 81,
	155, 98, 152, 113, 154, 64, 225, 79,
	43, 183, 38, 10, 91, 65, 26, 45,
	94, 175, 165, 42, 8, 40, 151, 195,
	67, 225, 157, 236, 218, 130, 242, 80,
	65, 44, 205, 197, 175, 207, 198, 28,
	0, 128, 143, 128, 4, 94, 211, 223,
	212, 81, 22, 22, 160, 217, 251, 241,
	104, 117, 136, 197, 144, 48, 209, 34,
}

func newTinyRNG(seed uint32) *tinyRNG {
	size := uint32(len(rngTable))
	var idx int
	if size > 0 {
		idx = int(seed % size)
	}
	return &tinyRNG{index: idx, seed: seed}
}

func (r *tinyRNG) Intn(n int) int {
	if n <= 0 {
		return 0
	}
	b := rngTable[r.index]
	r.index++
	if r.index >= len(rngTable) {
		r.seed = (r.seed*1664525 + 1013904223) ^ uint32(b)
		if len(rngTable) > 0 {
			r.index = int(r.seed % uint32(len(rngTable)))
		} else {
			r.index = 0
		}
	}
	return int(b) % n
}
